[{"title":"1. SUBSCRIPTION PRODUCT BREAKDOWN WITH CHURN","sql":"SELECT product_name, COUNT(*) total, SUM(CASE WHEN subscription_status='Active' THEN 1 ELSE 0 END) active, SUM(CASE WHEN subscription_status='Inactive' THEN 1 ELSE 0 END) churned, CAST(SUM(CASE WHEN subscription_status='Active' THEN 1 ELSE 0 END)*100.0/COUNT(*) AS DECIMAL(5,1)) AS retention_pct, CAST(AVG(amount) AS DECIMAL(8,2)) avg_price FROM serving.subscription_detail GROUP BY product_name ORDER BY COUNT(*) DESC"},{"title":"2. SUBSCRIBER -> DONOR CROSSOVER","sql":"SELECT CASE WHEN d.person_id IS NOT NULL THEN 'Also a Donor' ELSE 'Never Donated' END AS donor_status, s.subscription_status, COUNT(DISTINCT s.person_id) subscribers, CAST(ISNULL(AVG(d.total_given),0) AS INT) avg_giving FROM serving.subscription_detail s LEFT JOIN serving.donor_summary d ON d.person_id=s.person_id GROUP BY CASE WHEN d.person_id IS NOT NULL THEN 'Also a Donor' ELSE 'Never Donated' END, s.subscription_status ORDER BY 1,2"},{"title":"3. ORDER_DETAIL SAMPLE (top 5)","sql":"SELECT TOP 5 * FROM serving.order_detail"},{"title":"3b. COMMERCE TOP 20 PRODUCTS BY REVENUE","sql":"SELECT TOP 20 display_name, COUNT(*) orders, CAST(SUM(total_amount) AS INT) total_spent, CAST(AVG(total_amount) AS INT) avg_order FROM serving.order_detail WHERE display_name<>'Unknown' AND total_amount>0 GROUP BY display_name HAVING COUNT(*)>=5 ORDER BY SUM(total_amount) DESC"},{"title":"4. BUYERS WHO NEVER DONATED","sql":"SELECT COUNT(DISTINCT o.person_id) AS total_buyers, SUM(CASE WHEN d.person_id IS NULL THEN 1 ELSE 0 END) AS never_donated, CAST(SUM(CASE WHEN d.person_id IS NULL THEN o.total_amount ELSE 0 END) AS INT) AS commerce_only_spend FROM (SELECT person_id, SUM(total_amount) AS total_amount FROM serving.order_detail WHERE display_name<>'Unknown' GROUP BY person_id) o LEFT JOIN serving.donor_summary d ON d.person_id=o.person_id"},{"title":"5. ORDER FREQUENCY SEGMENTS","sql":"WITH buyer_stats AS (SELECT person_id, COUNT(*) orders, SUM(total_amount) total_spent, MAX(order_date) last_order FROM serving.order_detail WHERE display_name<>'Unknown' GROUP BY person_id) SELECT CASE WHEN orders=1 THEN '1-Single Buyer' WHEN orders BETWEEN 2 AND 5 THEN '2-Repeat (2-5)' WHEN orders BETWEEN 6 AND 20 THEN '3-Loyal (6-20)' ELSE '4-VIP (20+)' END AS segment, COUNT(*) buyers, CAST(AVG(total_spent) AS INT) avg_spend, CAST(AVG(orders) AS INT) avg_orders FROM buyer_stats GROUP BY CASE WHEN orders=1 THEN '1-Single Buyer' WHEN orders BETWEEN 2 AND 5 THEN '2-Repeat (2-5)' WHEN orders BETWEEN 6 AND 20 THEN '3-Loyal (6-20)' ELSE '4-VIP (20+)' END ORDER BY 1"},{"title":"6. SUBSCRIPTION PRICE SENSITIVITY","sql":"SELECT CASE WHEN amount<20 THEN '$0-$20' WHEN amount<35 THEN '$20-$35' WHEN amount<50 THEN '$35-$50' WHEN amount<100 THEN '$50-$100' ELSE '$100+' END AS price_range, COUNT(*) total, SUM(CASE WHEN subscription_status='Active' THEN 1 ELSE 0 END) active, CAST(SUM(CASE WHEN subscription_status='Active' THEN 1.0 ELSE 0 END)*100/COUNT(*) AS DECIMAL(5,1)) retention_pct FROM serving.subscription_detail GROUP BY CASE WHEN amount<20 THEN '$0-$20' WHEN amount<35 THEN '$20-$35' WHEN amount<50 THEN '$35-$50' WHEN amount<100 THEN '$50-$100' ELSE '$100+' END ORDER BY MIN(amount)"},{"title":"7. TRIPLE OVERLAP: Subscriber + Donor + Buyer","sql":"SELECT CASE WHEN d.person_id IS NOT NULL AND o.person_id IS NOT NULL THEN 'Donor+Buyer+Subscriber' WHEN d.person_id IS NOT NULL THEN 'Donor+Subscriber' WHEN o.person_id IS NOT NULL THEN 'Buyer+Subscriber' ELSE 'Subscriber Only' END AS overlap, COUNT(DISTINCT s.person_id) people FROM serving.subscription_detail s LEFT JOIN serving.donor_summary d ON d.person_id=s.person_id LEFT JOIN (SELECT DISTINCT person_id FROM serving.order_detail) o ON o.person_id=s.person_id GROUP BY CASE WHEN d.person_id IS NOT NULL AND o.person_id IS NOT NULL THEN 'Donor+Buyer+Subscriber' WHEN d.person_id IS NOT NULL THEN 'Donor+Subscriber' WHEN o.person_id IS NOT NULL THEN 'Buyer+Subscriber' ELSE 'Subscriber Only' END ORDER BY 1"},{"title":"8. LOST RECURRING DONORS - STATUS BREAKDOWN","sql":"SELECT CASE WHEN status LIKE '%TOKEN NOT FINDABLE%' THEN 'Token Lost' WHEN status LIKE '%PROCESSED%' THEN 'Processed in Givebutter' WHEN going_to_givebutter='YES' THEN 'Migrated to Givebutter' ELSE 'Other' END AS category, COUNT(*) donors, CAST(SUM(monthly_amount) AS INT) monthly_mrr, CAST(SUM(annual_value) AS INT) annual_value FROM serving.lost_recurring_donors GROUP BY CASE WHEN status LIKE '%TOKEN NOT FINDABLE%' THEN 'Token Lost' WHEN status LIKE '%PROCESSED%' THEN 'Processed in Givebutter' WHEN going_to_givebutter='YES' THEN 'Migrated to Givebutter' ELSE 'Other' END ORDER BY SUM(monthly_amount) DESC"}]